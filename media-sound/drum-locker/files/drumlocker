#!/bin/bash
# Drum Locker wrapper script

INSTALL_DIR="/opt/bin/audioassault/drumlocker"
USER_LV2="${HOME}/.lv2"
USER_VST3="${HOME}/.vst3"
USER_DATA="${HOME}/Audio Assault/PluginData/Audio Assault/DrumLockerData"

show_help() {
	cat <<HELP
Usage: drumlocker [OPTION]

Options:
  -i, --install     Install Drum Locker files to your home directory
  -u, --uninstall   Remove Drum Locker files from your home directory
  -h, --help        Show this help message

Installation copies:
  - LV2 plugin to ~/.lv2/
  - VST3 plugin to ~/.vst3/
  - Plugin data to ~/Audio Assault/PluginData/Audio Assault/DrumLockerData/

HELP
}

install_user() {
	echo "Installing Drum Locker to your home directory..."
	echo ""

	# Create directories
	mkdir -p "${USER_DATA}"

	# Copy DrumLockerData
	if [ -d "${INSTALL_DIR}/DrumLockerData" ]; then
		cp -r "${INSTALL_DIR}/DrumLockerData"/* "${USER_DATA}/"
		echo "✓ Installed plugin data to ${USER_DATA}"
	else
		echo "✗ DrumLockerData not found"
	fi

	# Copy LV2 plugin
	if [ -d "/usr/lib64/lv2/Drum Locker.lv2" ]; then
		mkdir -p "${USER_LV2}"
		cp -r "/usr/lib64/lv2/Drum Locker.lv2" "${USER_LV2}/"
		echo "✓ Installed LV2 plugin to ${USER_LV2}/"
	fi

	# Copy VST3 plugin
	if [ -d "/usr/lib64/vst3/Drum Locker.vst3" ]; then
		mkdir -p "${USER_VST3}"
		cp -r "/usr/lib64/vst3/Drum Locker.vst3" "${USER_VST3}/"
		echo "✓ Installed VST3 plugin to ${USER_VST3}/"
	fi

	echo ""
	echo "Installation complete!"
	echo ""
	echo "==============================================================================="
	echo "Ensure your DAW is configured to scan:"
	echo "  - ${USER_LV2} (for LV2 plugins)"
	echo "  - ${USER_VST3} (for VST3 plugins)"
	echo "==============================================================================="
}

uninstall_user() {
	echo "Removing Drum Locker from your home directory..."
	echo ""

	# Remove LV2 plugin
	if [ -d "${USER_LV2}/Drum Locker.lv2" ]; then
		rm -rf "${USER_LV2}/Drum Locker.lv2"
		echo "✓ Removed LV2 plugin"
	fi

	# Remove VST3 plugin
	if [ -d "${USER_VST3}/Drum Locker.vst3" ]; then
		rm -rf "${USER_VST3}/Drum Locker.vst3"
		echo "✓ Removed VST3 plugin"
	fi

	# Ask about plugin data
	if [ -d "${USER_DATA}" ]; then
		read -p "Remove plugin data (drum samples, presets)? [y/N] " -n 1 -r
		echo
		if [[ $REPLY =~ ^[Yy]$ ]]; then
			rm -rf "${USER_DATA}"
			# Try to remove parent directories if empty
			rmdir "${HOME}/Audio Assault/PluginData/Audio Assault" 2>/dev/null
			rmdir "${HOME}/Audio Assault/PluginData" 2>/dev/null
			rmdir "${HOME}/Audio Assault" 2>/dev/null
			echo "✓ Removed plugin data"
		else
			echo "  Keeping plugin data at ${USER_DATA}"
		fi
	fi

	echo ""
	echo "Uninstallation complete!"
}

# Parse command line arguments
case "${1}" in
	-i|--install)
		install_user
		;;
	-u|--uninstall)
		uninstall_user
		;;
	-h|--help)
		show_help
		;;
	"")
		echo "Error: Drum Locker does not have a standalone application."
		echo "Use 'drumlocker --help' for usage information"
		exit 1
		;;
	*)
		echo "Unknown option: ${1}"
		echo "Use 'drumlocker --help' for usage information"
		exit 1
		;;
esac
